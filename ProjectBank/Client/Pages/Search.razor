@page "/search"
@using System.Data.SqlTypes
@inject HttpClient Http

<PageTitle>ProjectBank - Search</PageTitle>

<div class="searchBar_wrapper">
    <input @bind="SearchText" type="text" class="searchBar" runat="server" name="Search_input" placeholder="Search... Project Title, Supervisor, or #Keyword">
    <button class="btn_search" @onclick="LoadProjects"> <span class="oi oi-magnifying-glass" style="color: #212121;" aria-hidden="true"></span></button>
</div>

@if (_projects == null)
{
    
}
else{
    @foreach (var project in _projects)
    {
     <br/>
       <div class="project_center">
          <div class="project_builder_search">
              <div class="project_search_content">
                  <div class="like_star">
                      <input type="checkbox" id="star_checkbox" unchecked="true" onchange=""/>
                      <label class="oi oi-star" id="star" for="star_checkbox"></label>
                  </div>
                  <div id="project_search_title">Title: @project.Title </div>
                  <div id="search_supervisor">by: <x onclick="">@project.AuthorName</x></div>
                  <br>
                  <hr>
                  <br>
                  <textarea class="project_search_description" readonly="readonly">@project.Description</textarea>
                  @if (_isHidden)
                  {
                      <label id="see_more" @onclick="SwitchVisibilityState">See more</label>
                  }
                  @if (!_isHidden)
                  {
                      <div class="expanded_content" id="expand">
                          <br>
                          <hr>
                          <br>
                          <textarea class="project_search_keywords" readonly="readonly">@string.Join(", ",project.Keywords)</textarea> 
                          <br>
                          <hr>
                          <br>
                          <label class="project_search_Ects" readonly="readonly">Ects: @project.Ects </label> 
                          <br>
                          <label class="project_search_degree" readonly="readonly">Degree: @project.Degree </label>
                          <br>
                          <label id="close_more" @onclick="SwitchVisibilityState">Close</label>
                      </div>
                  }
              </div>
          </div>
       </div>  
    }
}


@code {
    private bool _isHidden = true;
    private void SwitchVisibilityState()
    {
        if (_isHidden == true)
        {
            _isHidden = false;
        }
        else
        {
            _isHidden = true;
        } 
        
    }
    
    public string SearchText = "";
    
    ProjectDetailsDto[]? _projects;

    async void LoadProjects()
    {
        try
        {
            _projects = await Http.GetFromJsonAsync<ProjectDetailsDto[]?>($"/api/Project/{SearchText}");
        }
        catch(AccessTokenNotAvailableException exception)
        {
            exception.Redirect();
        }
        await InvokeAsync(StateHasChanged);
    }
}
